{% extends "base.html" %}
{% block title %}Scan | VirusLens ‚Äî Cyber Threat Analyzer{% endblock %}
{% block content %}

<div class="container mx-auto px-6 py-10 text-white">
  <h1 class="text-3xl font-semibold mb-8 text-center text-cyan-400">
    üîç VirusLens ‚Äî Cyber Threat Analyzer
  </h1>

  <!-- Scan Section -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-10">

    <!-- URL Scan Section -->
    <div class="bg-[#121826] rounded-2xl shadow-lg p-6 border border-gray-700">
      <h2 class="text-xl font-bold mb-4 text-cyan-300">Scan URL</h2>
      <form id="url-scan-form" class="flex flex-col gap-3">
        <label for="scan-url-input" class="text-sm text-gray-400">Enter URL</label>
        <input
          id="scan-url-input"
          name="url"
          type="text"
          placeholder="https://example.com"
          class="p-2 rounded-lg bg-gray-800 border border-gray-600 text-white focus:ring-2 focus:ring-cyan-400 focus:outline-none"
        />
        <button
          id="scan-url-button"
          type="submit"
          class="bg-cyan-600 hover:bg-cyan-700 transition-colors text-white font-semibold py-2 px-4 rounded-lg"
        >
          Scan URL
        </button>
      </form>

      <div id="url-result" class="mt-6 bg-gray-900 p-4 rounded-lg border border-gray-700 text-sm text-green-300 whitespace-pre-wrap"></div>
    </div>

    <!-- File Scan Section -->
    <div class="bg-[#121826] rounded-2xl shadow-lg p-6 border border-gray-700">
      <h2 class="text-xl font-bold mb-4 text-cyan-300">Scan File</h2>
      <form id="file-scan-form" class="flex flex-col gap-3" enctype="multipart/form-data">
        <label for="scan-file-input" class="text-sm text-gray-400">Upload a file (max 200MB)</label>
        <input
          id="scan-file-input"
          name="file"
          type="file"
          class="p-2 rounded-lg bg-gray-800 border border-gray-600 text-white focus:ring-2 focus:ring-cyan-400 focus:outline-none"
        />
        <button
          id="scan-file-button"
          type="submit"
          class="bg-cyan-600 hover:bg-cyan-700 transition-colors text-white font-semibold py-2 px-4 rounded-lg"
        >
          Scan File
        </button>
      </form>

      <div id="file-result" class="mt-6 bg-gray-900 p-4 rounded-lg border border-gray-700 text-sm text-green-300 whitespace-pre-wrap"></div>
    </div>

  </div>
</div>

<!-- ===================== -->
<!-- üß† JavaScript Section -->
<!-- ===================== -->
<script>
document.addEventListener("DOMContentLoaded", function () {

  // ---------- URL Scan ----------
  const urlForm = document.getElementById("url-scan-form");
  const urlInput = document.getElementById("scan-url-input");
  const urlResult = document.getElementById("url-result");
  const urlButton = document.getElementById("scan-url-button");

  urlForm.addEventListener("submit", async (ev) => {
    ev.preventDefault();
    const url = urlInput.value.trim();
    if (!url) {
      alert("Please enter a URL to scan");
      return;
    }

    urlButton.disabled = true;
    urlButton.textContent = "Scanning...";

    try {
      const response = await fetch("/Scan", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url }),
      });

      const data = await response.json();
      if (!response.ok) {
        urlResult.textContent = "‚ö†Ô∏è Error: " + (data.detail || JSON.stringify(data));
        urlResult.style.color = "red";
      } else {
        urlResult.style.color = "lightgreen";
        urlResult.textContent =
          "‚úÖ Scan Successful\n\n" + JSON.stringify(data, null, 2);
      }
    } catch (err) {
      urlResult.textContent = "‚ùå Network error: " + err.message;
      urlResult.style.color = "red";
    } finally {
      urlButton.disabled = false;
      urlButton.textContent = "Scan URL";
    }
  });

  // ---------- File Scan ----------
  const fileForm = document.getElementById("file-scan-form");
  const fileInput = document.getElementById("scan-file-input");
  const fileResult = document.getElementById("file-result");
  const fileButton = document.getElementById("scan-file-button");

  fileForm.addEventListener("submit", async (ev) => {
    ev.preventDefault();
    const file = fileInput.files[0];
    if (!file) {
      alert("Please select a file to scan");
      return;
    }

    fileButton.disabled = true;
    fileButton.textContent = "Scanning...";

    try {
      const formData = new FormData();
      formData.append("file", file);

      const response = await fetch("/ScanFile", {
        method: "POST",
        body: formData,
      });

      const data = await response.json();
      if (!response.ok) {
        fileResult.textContent = "‚ö†Ô∏è Error: " + (data.detail || JSON.stringify(data));
        fileResult.style.color = "red";
      } else {
        fileResult.style.color = "lightgreen";
        fileResult.textContent =
          "‚úÖ File Scan Successful\n\n" + JSON.stringify(data, null, 2);
      }
    } catch (err) {
      fileResult.textContent = "‚ùå Network error: " + err.message;
      fileResult.style.color = "red";
    } finally {
      fileButton.disabled = false;
      fileButton.textContent = "Scan File";
    }
  });
});
</script>

{% endblock %}
